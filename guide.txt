ğŸ” Login
POST /api/auth/login
Body
{
  "username": "superadmin",
  "password": "ChangeMe123"
}

Response
{
  "_id": "65f9...",
  "username": "superadmin",
  "role": "super_admin",
  "regions": [],
  "token": "JWT_TOKEN_HERE"
}

ğŸ”‘ How frontend uses auth
Store token


Send in headers for all requests:


Authorization: Bearer JWT_TOKEN_HERE


2. CLIENTS (BORROWERS â€“ NO LOGIN)
ğŸ‘¤ Onboard Client
POST /api/clients/onboard
 Auth: super_admin, initiator_admin, approver_admin, loan_officer
 Content-Type: multipart/form-data
Form Fields
name
nationalId
phone
residence          (owned | rented)
businessType
businessLocation
nextOfKinName
nextOfKinPhone
nextOfKinRelationship
groupId
photo              (file)

Response
{
  "message": "Client onboarded successfully",
  "client": { "_id": "...", "name": "...", "groupId": "..." }
}


ğŸ“‹ Get All Clients
GET /api/clients
Response
[
  {
    "_id": "...",
    "name": "...",
    "nationalId": "...",
    "groupId": { "name": "Group A" }
  }
]


3. GROUPS (BORROWER GROUPS)
â• Create Group
POST /api/groups
{
  "name": "Githurai Women Group",
  "meetingDay": "Wednesday",
  "meetingTime": "10:00",
  "loanOfficerId": "USER_ID"
}


âœï¸ Assign Signatories
PUT /api/groups/:id/assign-signatories
{
  "signatoryAssignments": [
    { "role": "chairperson", "memberNationalId": "123" },
    { "role": "secretary", "memberNationalId": "456" },
    { "role": "treasurer", "memberNationalId": "789" }
  ]
}


ğŸ“‹ Get Groups
GET /api/groups

4. LOANS (CORE WORKFLOW)
ğŸ“ Initiate Loan
POST /api/loans/initiate
 Auth: initiator_admin, loan_officer
{
  "clientNationalId": "34038490",
  "type": "business",
  "amount": 20000,
  "term": 6
}

Rules enforced
Client must have â‰¥ 20% savings


Must have repaid at least one loan


Group must have signatories



ğŸ‘¥ Add Guarantor
POST /api/guarantors
{
  "loanId": "LOAN_ID",
  "clientId": "CLIENT_ID",
  "relationship": "Brother",
  "idCopyUrl": "/uploads/id.jpg",
  "photoUrl": "/uploads/photo.jpg"
}


âœ… Accept Guarantor
PUT /api/guarantors/:id/accept

ğŸ“Š Credit Assessment (5 Câ€™s)
POST /api/credit-assessments
{
  "loanId": "LOAN_ID",
  "character": 4,
  "capacity": 4,
  "capital": 4,
  "collateral": 3,
  "conditions": 4,
  "officerNotes": "Stable business"
}

Rule
Minimum total score = 18 / 25



âœ”ï¸ Approve Loan
PUT /api/loans/:id/approve
 Auth: approver_admin, super_admin

ğŸ’° Disburse Loan (FINAL STEP)
POST /api/loans/:id/disburse
 Auth: super_admin, approver_admin
What frontend should show
â€œDisburseâ€ button ONLY if:


Loan status = approved


Credit assessment exists


At least 1 guarantor accepted



ğŸ“‹ Get Loans
GET /api/loans

5. REPAYMENTS
ğŸ’µ Record Repayment
POST /api/repayments
{
  "loanId": "LOAN_ID",
  "amount": 5000,
  "paymentMethod": "mpesa",
  "transactionId": "QWE123ABC"
}


ğŸ“œ Repayment History
GET /api/repayments/loan/:loanId

6. SYSTEM / UTILITY
â¤ï¸ Health Check
GET /api/health



{
  "status": "OK",
  "service": "Microfinance Core API",
  "timestamp": "..."
}


7. FRONTEND EXPECTATIONS (VERY IMPORTANT)
Frontend should:
Never allow clients to login


Role-gate UI actions:


Initiate loan â†’ initiator_admin / loan_officer


Approve â†’ approver_admin


Disburse â†’ super_admin / approver_admin


Follow loan lifecycle strictly


Loan lifecycle for UI:
initiated
â†’ guarantors added
â†’ guarantor accepted
â†’ credit assessed
â†’ approved
â†’ disbursed
â†’ repayments


8. HOW FRONTEND CAN TEST QUICKLY
Login â†’ store token


Create group


Onboard client


Initiate loan


Add guarantor â†’ accept


Submit credit assessment


Approve loan


Disburse loan


Record repayment
